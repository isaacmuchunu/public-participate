# Public Participate Queue Worker Configuration for Supervisor
# This file should be copied to /etc/supervisor/conf.d/
# Usage: sudo supervisorctl reread && sudo supervisorctl update

# High Priority Queue Workers (Notifications, OTP, Critical Operations)
[program:public-participate-worker-high]
process_name=%(program_name)s_%(process_num)02d
command=php /path/to/public-participate/artisan queue:work redis --queue=high --sleep=3 --tries=3 --max-time=3600 --timeout=60
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=www-data
numprocs=2
redirect_stderr=true
stdout_logfile=/path/to/public-participate/storage/logs/worker-high.log
stopwaitsecs=3600
priority=100

# Default Queue Workers (Submissions, Engagements, General Tasks)
[program:public-participate-worker-default]
process_name=%(program_name)s_%(process_num)02d
command=php /path/to/public-participate/artisan queue:work redis --queue=default --sleep=3 --tries=3 --max-time=3600 --timeout=90
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=www-data
numprocs=4
redirect_stderr=true
stdout_logfile=/path/to/public-participate/storage/logs/worker-default.log
stopwaitsecs=3600
priority=200

# Low Priority Queue Workers (Analytics, AI Processing, Cleanup Tasks)
[program:public-participate-worker-low]
process_name=%(program_name)s_%(process_num)02d
command=php /path/to/public-participate/artisan queue:work redis --queue=low --sleep=5 --tries=2 --max-time=3600 --timeout=120
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=www-data
numprocs=2
redirect_stderr=true
stdout_logfile=/path/to/public-participate/storage/logs/worker-low.log
stopwaitsecs=3600
priority=300

# Queue Worker Group
[group:public-participate-workers]
programs=public-participate-worker-high,public-participate-worker-default,public-participate-worker-low
priority=999
